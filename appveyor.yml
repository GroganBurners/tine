# appveyor file:
# http://www.appveyor.com/docs/appveyor-yml
os: Visual Studio 2017

# version: {branch}

# branches to build
branches:
  # whitelist
  only:
    - master

# Do not build on tags (GitHub only)
skip_tags: true

# environment variables
environment:
  matrix:
    - PYTHON: "C:/Python36-x64"
  SECRET_KEY: "test"
  POSTGRES_HOST: "127.0.0.1"
  POSTGRES_PORT: "5432"
  POSTGRES_NAME: "gbs"
  POSTGRES_USER: "postgres"
  POSTGRES_PASS: "Password12!"

# enable service required for build/tests
services:
    - postgresql101

init:
  - "ECHO %PYTHON%"
  - ps: "ls C:/Python*"

build_script:
  - SET PGUSER=postgres
  - SET PGPASSWORD=Password12!
  - PATH=C:\Program Files\PostgreSQL\9.6\bin\;%PATH%
  - createdb gbs
install:
  - "SET PATH=%PYTHON%;%PYTHON%\\Scripts;%PATH%"
  # add databases
  - "pip install pipenv"
  - "pipenv install --dev --skip-lock"
# to run your custom scripts instead of automatic tests
test_script:
  - "SET PATH=%PYTHON%;%PYTHON%\\Scripts;%PATH%"
  - cmd: "pipenv run python manage.py showmigrations"
  - cmd: "pipenv run python manage.py makemigrations"
  - cmd: "pipenv run python manage.py migrate"
  - cmd: "pipenv run python manage.py test gbs"

