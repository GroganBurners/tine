# appveyor file:
# http://www.appveyor.com/docs/appveyor-yml
os: Visual Studio 2017

# version: {branch}

# branches to build
branches:
  # whitelist
  only:
    - master

# Do not build on tags (GitHub only)
skip_tags: true

# enable service required for build/tests
services:
    - postgresql101

# environment variables
environment:
  global:
    SECRET_KEY: BetPJpkaldjcnksjsdkk3jknj12
    DATABASE_URL: postgres://postgres:Password12!@localhost:5432/gbs
  matrix:
    - PYTHON: "C:\\Python38-x64"
      POSTGRES: "C:\\Program Files\\PostgreSQL\\10"
      PYTHON_VERSION: "3.8.X"
      PYTHON_ARCH: "64"
      WINDOWS_SDK_VERSION: "v7.1"

cache:
  # Cache Pip install
  - '%LOCALAPPDATA%\pip\Cache\http'
  - '%LOCALAPPDATA%\pip\Cache\wheels'

init:
  - "ECHO %PYTHON% %PYTHON_VERSION% %PYTHON_ARCH%"
  - "PATH=%PYTHON%;%PYTHON%\\Scripts;%PATH%"
  - "PATH=%POSTGRES%\\bin;%PATH%"

install:
  - "python -m pip install -r requirements.txt"

build_script:
  - "python --version"
  - SET PGUSER=postgres
  - SET PGPASSWORD=Password12!
  - createdb gbs
  - mkdir staticfiles
  - "python manage.py collectstatic"
  - "python manage.py showmigrations"
  - "python manage.py makemigrations"
  - "python manage.py migrate"

# to run your custom scripts instead of automatic tests
test_script:
  - "python manage.py test gbs"

